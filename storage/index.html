<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Multithreaded File Transfer Server</title>
<style>
body {
  margin: 0;
  padding: 0;
  background: linear-gradient(135deg, #1f1c2c, #928dab);
  font-family: "Segoe UI", sans-serif;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}

h1 {
  margin-top: 40px;
  font-size: 36px;
  animation: fadeIn 1.2s ease forwards;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Upload Box */
#drop-zone {
  width: 400px;
  height: 200px;
  border: 3px dashed rgba(255,255,255,0.7);
  border-radius: 20px;
  margin-top: 40px;
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
  transition: 0.3s;
  backdrop-filter: blur(5px);
  animation: fadeIn 1.5s ease forwards;
}

#drop-zone:hover {
  border-color: #00eaff;
  box-shadow: 0 0 20px #00eaff;
}

#drop-zone.active {
  border-color: #00ff62;
  box-shadow: 0 0 25px #00ff62;
}

/* Progress Bar */
#progress-container {
  width: 400px;
  height: 20px;
  border-radius: 10px;
  background: rgba(255,255,255,0.2);
  margin-top: 20px;
  overflow: hidden;
  display: none;
}

#progress-bar {
  height: 100%;
  background: linear-gradient(90deg, #00eaff, #00ff62);
  width: 0%;
  transition: width 0.2s;
}

button {
  margin-top: 20px;
  padding: 12px 20px;
  background: #00eaff;
  color: #000;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-size: 16px;
  transition: 0.3s;
}

button:hover {
  background: #00ff62;
  transform: scale(1.05);
}

/* File List */
#file-list {
  margin-top: 30px;
  width: 400px;
  animation: fadeIn 1s ease forwards;
}

.file-item {
  padding: 10px;
  background: rgba(255,255,255,0.2);
  margin-top: 8px;
  border-radius: 10px;
  display: flex;
  justify-content: space-between;
}

.file-item a {
  color: #00eaff;
  text-decoration: none;
  transition: 0.2s;
}

.file-item a:hover {
  color: #00ff62;
}
</style>
</head>
<body>

<h1>ðŸš€ File Transfer Server</h1>

<div id="drop-zone">
  <p>Drag & Drop a file here<br>or click to upload</p>
</div>

<input type="file" id="file-input" style="display:none;">

<div id="progress-container">
  <div id="progress-bar"></div>
</div>

<button onclick="fetchFileList()">Refresh File List</button>

<div id="file-list"></div>

<script>
// Drop Zone logic
const dropZone = document.getElementById("drop-zone");
const fileInput = document.getElementById("file-input");

dropZone.onclick = () => fileInput.click();

dropZone.addEventListener("dragover", e => {
  e.preventDefault();
  dropZone.classList.add("active");
});

dropZone.addEventListener("dragleave", e => {
  dropZone.classList.remove("active");
});

dropZone.addEventListener("drop", e => {
  e.preventDefault();
  dropZone.classList.remove("active");
  uploadFile(e.dataTransfer.files[0]);
});

fileInput.addEventListener("change", e => {
  uploadFile(e.target.files[0]);
});

// Upload function
function uploadFile(file) {
  const xhr = new XMLHttpRequest();
  xhr.open("POST", "/" + file.name);

  xhr.upload.onprogress = e => {
    document.getElementById("progress-container").style.display = "block";
    let percent = (e.loaded / e.total) * 100;
    document.getElementById("progress-bar").style.width = percent + "%";
  };

  xhr.onload = () => {
    alert("Upload Complete");
    document.getElementById("progress-bar").style.width = "0%";
    document.getElementById("progress-container").style.display = "none";
    fetchFileList();
  };

  xhr.send(file);
}

// Fetch files list
function fetchFileList() {
  fetch("/").then(async res => {
    let files = await res.text();
    let listDiv = document.getElementById("file-list");
    listDiv.innerHTML = "";

    const entries = files.split("\n").filter(x => x.trim().length > 0);
    entries.forEach(name => {
      listDiv.innerHTML += `
        <div class="file-item">
          <span>${name}</span>
          <a href="${name}" download>Download</a>
        </div>
      `;
    });
  });
}

fetchFileList();
</script>
</body>
</html>
